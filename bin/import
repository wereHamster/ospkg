#!/usr/bin/bash

TMPDIR="$(mktemp -d /tmp/ospkg.XXXXX)"
xz -dc "$1" | tar -xf - -C "$TMPDIR"

PKGREPO="file:///var/pkg/repo"
eval "$(pkgensd -s "$PKGREPO" open "$1")"
pkgsend -s "$PKGREPO" include -d "$TMPDIR/files/" "$TMPDIR/manifest"
pkgsend -s "$PKGREPO" close

rm -rf "$TMPDIR"
