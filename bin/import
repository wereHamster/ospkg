#!/usr/bin/bash

if [ $# -lt 2 ]; then
  echo "$0 [package.tar.xz] [package@version]"
  exit
fi

TMPDIR="$(mktemp -d /tmp/ospkg.XXXXX)"
xz -dc "$1" | tar -xf - -C "$TMPDIR"

PKGREPO="file:///var/pkg/repo"
eval "$(pkgsend -s "$PKGREPO" open "$2")"
pkgsend -s "$PKGREPO" include -d "$TMPDIR/files/" "$TMPDIR/manifest"
pkgsend -s "$PKGREPO" close

rm -rf "$TMPDIR"
