VERSION="1.8.0-1"
SOURCE="js-1.8.0-rc1.tar.gz"

unpack () {
  mkdir -p 32bit 64bit
  tar -xzf "$1" -C 32bit
  tar -xzf "$1" -C 64bit
}

build () {
  XCFLAGS="-DJS_C_STRINGS_ARE_UTF8 -DHAVE_VA_COPY -DVA_COPY=va_copy"
  OPTS="OS_CONFIG=SunOS5.9 BUILD_OPT=1 JS_DIST="$DESTDIR" OPTIMIZER="

  cd 32bit/js/src/ && rm lock*
  gmake -f Makefile.ref $OPTS XCFLAGS="$XCFLAGS"
  gmake -f Makefile.ref $OPTS XCFLAGS="$XCFLAGS" export

  cd ../../../64bit/js/src/ && rm lock*
  gmake -f Makefile.ref $OPTS XCFLAGS="$XCFLAGS" CC="cc -m64" LIBDIR=lib/amd64
  gmake -f Makefile.ref $OPTS XCFLAGS="$XCFLAGS" CC="cc -m64" LIBDIR=lib/amd64 export
}
